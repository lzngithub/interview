# supXmind 认知决策基础平台

## 项目名称

supXmind 认知决策基础平台

## 职位名称

前端开发工程师

## 时间

- 开发时间：2023.04.01-2023.11.01

## 技术栈

主技术栈

UmiJS@3.0.0 + less + AntD@4.0.0 + + EChats@4.0.0 + umi-request + ahooks@3.0.0 + react-quill@2.0.0

相关的库

cross-env + lodash + crypto-js + moment + file-saver

## 项目背景

量知产业知识中台内部产品，前身为 SuperMind 认知计算平台。以知识计算为核心的认知决策基础平台，贯穿从“大数据”到“大知识”再到“大交互”的全流程人机协同知识计算链路，帮助组织打造数智中枢，助力组织全员更快更好决策。

## 平台架构

- 天蓬大数据平台：以量知内部大数据平台的搭建和使用产生的经验和技术能力，结合天蓬的定位和功能，集成数睿平台的部分功能和技术能力，整合形成天蓬大数据平台。
- 天心大知识平台：
  - 图谱中心：概念图谱、实例图谱、链式图谱等
  - 图谱工场：大图构建、图谱管理
  - 模型中心：垂直大语言模型、内容理解模型、图谱推理模型
  - 模型工厂：语料管理、模型开发、模型管理
- 天英大交互平台：智能语义搜索引擎，智能知识问答引擎，智能图谱探析引擎，智能报告生成引擎

## 工作描述

负责天英大交互平台的智能知识问答模块和智能报告生成引擎开发 v1.0 版本开发。

- 负责智能知识问答模块的开发，开发难点：
  - 处理流式数据:采用 fetch 封装进行 sse 分段流的处理 hooks
  - 实现打印机效果：采用数据接口队列的方式进行返回数据的处理。
- 负责智能报告生成引擎开发，开发难点：
  - 实现文本和图片的同时复制，采用'text/html'方式复制到剪切板，文字采用'text/plain'方式复制到剪切板。
  - 富文本的选型问题：考虑开发周期和后期扩展程度选择 quill.js 进行富文本的开发。

### 智能问答模块

是量知内部 supMind 的交互组件工具，是属于应用层的工具，内部核心能力为量知这家工作通过企业内部的产业数据库训练出来的产业大模型。

- 产业数据库训练的 ai 产业大模型。
- 类似于百度文心一言的交互式问答模式，一问一答，主要是关于企业、产业方面的知识。
- 前端需要实现像 chatgtp 一样接收流式数据的逻辑处理。
  - 实现逻辑：将整个代码分为三层
    - 处理 sse 的逻辑，包括接口连接的开启，接收数据，连接出错，连接关闭方面的逻辑，导出数据。
    - 处理接受的数据，因为数据需要不断的进行打印且数据发送是由后端控制，需要定义一个队列的数据结构进行数据处理。
    - 处理展示层代码，根据问答形式的数组数据进行 ui 组件的封装。

遇到的问题点：

1. sse 接口是分段发送，通过 apiPost 调试也是分段返回的，但在代码里面虽然是分段返回，但会在最后一起返回。解决办法：打开浏览器查看 network 面板接口状态，发现后端开启了压缩，开启压缩会导致这种情况。

### 智能报告生成模块

将智能问答模块和预先设置的模版和相关的素材和富文本结合起来，生成一份产业报告，从多个维度对企业和产业进行分析。

为什么选择 quill：

- api 简单，概念清晰;
- 有一定的封装性，也有底层定制开发能力。

有关 quill 富文本的基础知识：

- Delta 被用做描述 Quill 编辑器的内容和变化，简单但表达力强的数据格式。这种格式本质上是一种 JSON 格式，人类可读同时及其也能容易识别。是一种扁平化的数据结构，性能会好很多。
- quill 视图层基于 contenteditable，逻辑层对 DOM 进行抽象，用数据去驱动视图更新。

- 富文本模块的二次封装：
  - 主要是和其他素材（图片、文字）的交互，通过复制和拖拽的方式。
  - 基本功能的扩展，定制字体，导入新字体，复写对应的字体的样式文件。
  - 文本的导出为 pdf 的 g 功能开发，基本原理通过 html2canvas 用于将 DOM 节点转换为 Canvas，而 jspdf 用于将 Canvas 转换为 PDF。（不能采用直接将 delta 格式数据转成 pdf 的方法）

遇到问题：

1. 复制到剪切板的功能本地开发的时候没有问题，上到测试环境就有问题，原因在于剪切板的的一个 api 要运行在 https 环境才有。
2. 复制到剪切板需要文字和图片一块复制，这个时候要把复制内容设置为 text/html 的格式，但这个时候内容可以粘贴到富文本，但是没办法粘贴到输入框，因为包含了图片，这个时候需要把文字设置为 text 格式在复制一遍到剪切板才行。

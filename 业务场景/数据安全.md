# 前端安全

## 简单了解 web 的攻击方式有哪些

1. xss：跨站脚本攻击（cross site sripting）

## xss

攻击者在网站中嵌入恶意代码，当用户打开网站的时候，恶意代码被运行，可以用于盗取用户的 cookie，权限，账号密码或者下载病毒等。

### 嵌入代码的实现方式

1. 一般在用户界面可以输入的地方，比如：登陆，信息采集，评论区等，在这些地方去输入恶意代码;
2. 通过恶意链接，用户点击则会打开目标网站，执行恶意链接中的代码，比如一些搜索网站通过 url 去携带查询搜索参数。

### xss 分类

#### 1.反射型 xss

也叫非持久型 xss，顾名思义，恶意 JavaScript 脚本属于用户发送给网站请求中的一部分，随后网站又将这部分返回给用户，恶意脚本在页面中被执行。一般发生在前后端一体的应用中，服务端逻辑会改变最终的网页代码。

反射型 XSS 的攻击步骤

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. 用户打开带有恶意代码的 URL 时，浏览器打开被攻击网站，向服务器发起请求，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

#### 2.基于 dom 的 xss 攻击

目前更流行前后端分离的项目，反射型 XSS 无用武之地。 但这种攻击不需要经过服务器，我们知道，网页本身的 JavaScript 也是可以改变 HTML 的，黑客正是利用这一点来实现插入恶意脚本。

基于 DOM 的 XSS 攻击步骤：

1. 攻击者构造出特殊的 URL，其中包含恶意代码。
2. 用户打开带有恶意代码的 URL。
3. 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

#### 3.存储型 xss 攻击

又叫持久型 XSS，顾名思义，黑客将恶意 JavaScript 脚本长期保存在服务端数据库中，用户一旦访问相关页面数据，恶意脚本就会被执行。常见于搜索、微博、社区贴吧评论等。

存储型 XSS 的攻击步骤：

1. 攻击者将恶意代码提交到目标网站的数据库中。
2. 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

### 解决办法

解决办法：

- 尽量不要使用 eval 、innerHTML、setInterval 等可执行字符串的方法；
- 使用 Vue/React 技术栈，尽量不要使用 v-html/dangerouslySetInnerHTML 功能
- 对动态渲染的 html 标签做转义
- 渲染的数据都必须来自于服务端；尽量不要从 URL 等这种 DOM API
- 设置严格的 CSP，严格的 CSP 在 XSS 的防范中可以起到以下的作用：

#### Content Security Policy

使用 W3C 提出的 CSP (Content Security Policy，内容安全策略)，定义域名白名单，有以下作用：

- 禁止加载外域代码，防止复杂的攻击逻辑。
- 禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。
- 禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。
- 禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。
- 合理使用上报可以及时发现 XSS，利于尽快修复问题。
